<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - ExamPro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #f8fafc;
            --text: #1e293b;
            --accent: #ff6b6b;
            --secondary: #4ecdc4;
            --border: #e2e8f0;
            --error: #ef4444;
            --success: #22c55e;
            --warning: #f59e0b;
            --card-bg: #ffffff;
            --sidebar-width: 250px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Space Grotesk', sans-serif;
        }

        body {
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
        }

        /* Main Layout */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 2rem;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--card-bg);
            border-right: 1px solid var(--border);
            padding: 1.5rem;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-header i {
            font-size: 1.5rem;
            color: var(--accent);
        }

        .sidebar-header h2 {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 0.5rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: var(--text);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .nav-link:hover, .nav-link.active {
            background: var(--accent);
            color: white;
        }

        .nav-link i {
            font-size: 1.25rem;
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .card-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s;
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-secondary {
            background: #4a5568;
            color: white;
            margin-right: 0.5rem;
        }

        .btn-danger {
            background: #e53e3e;
            color: white;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            margin-top: 1rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            text-align: left;
            padding: 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--bg);
            font-weight: 600;
        }

        tr:hover {
            background: var(--bg);
        }

        /* Question Management */
        .option-input {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        .add-option-btn {
            background: #48bb78;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.25rem;
            cursor: pointer;
            margin-top: 0.5rem;
        }

        /* Student Credentials */
        .credentials-display {
            margin-top: 1rem;
            padding: 1rem;
            background: #f7fafc;
            border-radius: 0.5rem;
            border: 1px solid #e2e8f0;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            :root {
                --sidebar-width: 0px;
            }

            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                z-index: 1000;
            }

            .sidebar.active {
                transform: translateX(0);
                width: 250px;
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
            }

            .card {
                padding: 1rem;
            }

            .card-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .table-container {
                margin: 0 -1rem;
                padding: 0 1rem;
            }

            table {
                font-size: 0.9rem;
            }

            th, td {
                padding: 0.5rem;
            }

            .btn {
                width: 100%;
                margin-bottom: 0.5rem;
            }

            .btn-secondary {
                margin-right: 0;
            }

            .form-group {
                margin-bottom: 1rem;
            }

            .option-input {
                flex-direction: column;
                gap: 0.5rem;
            }

            .option-input input {
                width: 100%;
            }

            .option-input button {
                width: 100%;
            }
        }

        /* Mobile Menu Button */
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1001;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.5rem;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
            }
        }
    </style>
</head>
<body>
    <button class="mobile-menu-btn" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>
    <div class="sidebar">
        <div class="sidebar-header">
            <i class="fas fa-graduation-cap"></i>
            <h2>ExamPro</h2>
        </div>
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="#" class="nav-link active" onclick="showTab('students')">
                    <i class="fas fa-user-graduate"></i>
                    Students
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" onclick="showTab('exams')">
                    <i class="fas fa-file-alt"></i>
                    Exams
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" onclick="showTab('questions')">
                    <i class="fas fa-question-circle"></i>
                    Questions
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" onclick="showTab('results')">
                    <i class="fas fa-chart-bar"></i>
                    Results
                </a>
            </li>
        </ul>
    </div>

    <div class="main-content">
        <div class="header">
            <h1>Admin Dashboard</h1>
            <div class="user-menu">
                <button onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </button>
            </div>
        </div>

        <div id="students" class="tab-content active">
            <div class="card">
                <div class="card-header">
                    <h3>Add New Student</h3>
                </div>
                <form id="addStudentForm" onsubmit="return handleAddStudent(event)">
                    <div class="form-group">
                        <input type="text" class="form-control" id="studentName" placeholder="Student Name" required>
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-control" id="studentId" placeholder="Student ID" required>
                    </div>
                    <div class="form-group">
                        <input type="password" class="form-control" id="studentPassword" placeholder="Password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Student</button>
                </form>
                <div id="studentCredentials" class="credentials-display" style="display: none;">
                    <h4>Student Credentials:</h4>
                    <p>ID: <span id="newStudentId"></span></p>
                    <p>Password: <span id="newStudentPassword"></span></p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Student List</h3>
                </div>
                <div class="table-container">
                    <table id="studentTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="studentList"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="exams" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h3>Create New Exam</h3>
                </div>
                <form id="createExamForm" onsubmit="return handleCreateExam(event)">
                    <div class="form-group">
                        <input type="text" class="form-control" id="examTitle" placeholder="Exam Title" required>
                    </div>
                    <div class="form-group">
                        <textarea class="form-control" id="examDescription" placeholder="Exam Description" required></textarea>
                    </div>
                    <div class="form-group">
                        <input type="number" class="form-control" id="examDuration" placeholder="Duration (minutes)" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Create Exam</button>
                </form>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Exam List</h3>
                </div>
                <div class="table-container">
                    <table id="examTable">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Description</th>
                                <th>Duration</th>
                                <th>Questions</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="examList"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="questions" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h3>Add Questions to Exam</h3>
                </div>
                <form id="addQuestionForm" onsubmit="handleAddQuestion(event)">
                    <div class="form-group">
                        <select class="form-control" id="examSelect" required>
                            <option value="">Select Exam</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <textarea class="form-control" id="questionText" placeholder="Question Text" required></textarea>
                    </div>
                    <div id="optionsContainer">
                        <div class="option-input">
                            <input type="text" class="form-control" placeholder="Option 1" required>
                            <input type="radio" name="correctAnswer" value="0" required> Correct
                        </div>
                        <div class="option-input">
                            <input type="text" class="form-control" placeholder="Option 2" required>
                            <input type="radio" name="correctAnswer" value="1" required> Correct
                        </div>
                    </div>
                    <button type="button" class="add-option-btn" onclick="addOption()">Add Option</button>
                    <button type="submit" class="btn btn-primary" style="margin-top: 1rem;">Add Question</button>
                </form>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Questions List</h3>
                </div>
                <div id="questionsList"></div>
            </div>
        </div>

        <div id="results" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h3>Exam Results</h3>
                </div>
                <div class="table-container">
                    <table id="resultsTable">
                        <thead>
                            <tr>
                                <th>Student ID</th>
                                <th>Student Name</th>
                                <th>Exam</th>
                                <th>Score</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody id="resultsList"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // AUTHENTICATION AND INITIALIZATION
        // =============================================
        // Check if admin is logged in
        window.onload = function() {
            const admin = JSON.parse(localStorage.getItem('currentAdmin'));
            if (!admin) {
                window.location.href = 'login.html';
                return;
            }

            // Initialize dashboard based on current page
            const currentPage = window.location.hash.slice(1) || 'students';
            showTab(currentPage);
            loadData(currentPage);
        };

        // =============================================
        // Tab Navigation System
        // =============================================
        function showTab(tabName) {
            // Hide all tab content
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });

            // Show selected tab content
            document.getElementById(tabName).style.display = 'block';

            // Update active state in navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${tabName}`) {
                    link.classList.add('active');
                }
            });
        }

        // =============================================
        // Student Management
        // =============================================
        function loadStudents() {
            const students = JSON.parse(localStorage.getItem('students') || '[]');
            const studentList = document.getElementById('studentList');
            
            if (studentList) {
                if (students.length === 0) {
                    studentList.innerHTML = '<tr><td colspan="3" style="text-align: center;">No students added yet</td></tr>';
                } else {
                    studentList.innerHTML = students.map(student => `
                        <tr>
                            <td>${student.id}</td>
                            <td>${student.name}</td>
                            <td>
                                <button onclick="resetPassword('${student.id}')" class="btn btn-secondary">Reset Password</button>
                                <button onclick="deleteStudent('${student.id}')" class="btn btn-danger">Delete</button>
                            </td>
                        </tr>
                    `).join('');
                }
            }
        }

        function handleAddStudent(event) {
            event.preventDefault();
            
            // Get form values
            const name = document.getElementById('studentName').value;
            const id = document.getElementById('studentId').value;
            const password = document.getElementById('studentPassword').value;

            // Get existing students or initialize empty array
            let students = JSON.parse(localStorage.getItem('students') || '[]');
            
            // Check if student ID already exists
            if (students.some(student => student.id === id)) {
                alert('Student ID already exists!');
                return;
            }

            // Add new student
            const newStudent = { id, name, password };
            students.push(newStudent);
            
            // Save to localStorage
            localStorage.setItem('students', JSON.stringify(students));
            
            // Show credentials
            document.getElementById('newStudentId').textContent = id;
            document.getElementById('newStudentPassword').textContent = password;
            document.getElementById('studentCredentials').style.display = 'block';
            
            // Reset form
            event.target.reset();
            
            // Reload student list
            loadStudents();
            
            alert('Student added successfully!');
        }

        function deleteStudent(studentId) {
            if (confirm('Are you sure you want to delete this student?')) {
                let students = JSON.parse(localStorage.getItem('students') || '[]');
                students = students.filter(student => student.id !== studentId);
                localStorage.setItem('students', JSON.stringify(students));
                loadStudents();
            }
        }

        function resetPassword(studentId) {
            let students = JSON.parse(localStorage.getItem('students') || '[]');
            const student = students.find(s => s.id === studentId);
            
            if (student) {
                const newPassword = Math.random().toString(36).substring(2, 8);
                student.password = newPassword;
                localStorage.setItem('students', JSON.stringify(students));
                alert(`New password for ${student.name}: ${newPassword}`);
            }
        }

        // =============================================
        // Exam Management
        // =============================================
        function loadExams() {
            const exams = JSON.parse(localStorage.getItem('exams') || '[]');
            const examList = document.getElementById('examList');
            
            if (examList) {
                if (exams.length === 0) {
                    examList.innerHTML = '<tr><td colspan="5" style="text-align: center;">No exams created yet</td></tr>';
                } else {
                    examList.innerHTML = exams.map(exam => `
                        <tr>
                            <td>${exam.title}</td>
                            <td>${exam.description}</td>
                            <td>${exam.duration} minutes</td>
                            <td>${exam.questions ? exam.questions.length : 0}</td>
                            <td>
                                <button onclick="editExam('${exam.id}')" class="btn btn-secondary">Edit</button>
                                <button onclick="deleteExam('${exam.id}')" class="btn btn-danger">Delete</button>
                            </td>
                        </tr>
                    `).join('');
                }
            }

            // Also update the exam select dropdown for questions
            const examSelect = document.getElementById('examSelect');
            if (examSelect) {
                examSelect.innerHTML = `
                    <option value="">Select Exam</option>
                    ${exams.map(exam => `
                        <option value="${exam.id}">${exam.title}</option>
                    `).join('')}
                `;
            }
        }

        function handleCreateExam(event) {
            event.preventDefault();
            
            // Get form values
            const title = document.getElementById('examTitle').value;
            const description = document.getElementById('examDescription').value;
            const duration = document.getElementById('examDuration').value;

            // Get existing exams or initialize empty array
            let exams = JSON.parse(localStorage.getItem('exams') || '[]');
            
            // Create new exam object
            const newExam = {
                id: Date.now().toString(), // Unique ID using timestamp
                title,
                description,
                duration,
                questions: []
            };
            
            // Add to exams array
            exams.push(newExam);
            
            // Save to localStorage
            localStorage.setItem('exams', JSON.stringify(exams));
            
            // Reset form
            event.target.reset();
            
            // Reload exam list
            loadExams();
            
            alert('Exam created successfully!');
        }

        function deleteExam(examId) {
            if (confirm('Are you sure you want to delete this exam?')) {
                let exams = JSON.parse(localStorage.getItem('exams') || '[]');
                exams = exams.filter(exam => exam.id !== examId);
                localStorage.setItem('exams', JSON.stringify(exams));
                loadExams();
            }
        }

        function editExam(examId) {
            const exams = JSON.parse(localStorage.getItem('exams') || '[]');
            const exam = exams.find(e => e.id === examId);
            
            if (exam) {
                // For now, just show the questions tab
                document.getElementById('examSelect').value = examId;
                showTab('questions');
                loadQuestions(examId);
            }
        }

        // =============================================
        // Question Management
        // =============================================
        function loadExamSelect() {
            const exams = JSON.parse(localStorage.getItem('exams') || '[]');
            const select = document.getElementById('examSelect');
            select.innerHTML = '<option value="">Select Exam</option>';
            
            exams.forEach(exam => {
                const option = document.createElement('option');
                option.value = exam.id;
                option.textContent = exam.title;
                select.appendChild(option);
            });
        }

        function addOption() {
            const optionsContainer = document.getElementById('optionsContainer');
            const optionCount = optionsContainer.children.length;
            
            const optionDiv = document.createElement('div');
            optionDiv.className = 'option-input';
            optionDiv.innerHTML = `
                <input type="text" placeholder="Option ${optionCount + 1}" required>
                <input type="radio" name="correctAnswer" value="${optionCount}" required>
                <label>Correct Answer</label>
                <button type="button" onclick="this.parentElement.remove()" class="btn-delete">Remove</button>
            `;
            
            optionsContainer.appendChild(optionDiv);
        }

        function handleAddQuestion(event) {
            event.preventDefault();
            const form = event.target;
            const examId = form.examSelect.value;
            
            if (!examId) {
                alert('Please select an exam');
                return;
            }

            // Gather question data
            const question = {
                text: form.questionText.value,
                options: [],
                correctAnswer: parseInt(form.querySelector('input[name="correctAnswer"]:checked').value)
            };

            // Get options
            form.querySelectorAll('.option-input input[type="text"]').forEach(input => {
                question.options.push(input.value);
            });

            // Save question to exam
            const exams = JSON.parse(localStorage.getItem('exams') || '[]');
            const examIndex = exams.findIndex(e => e.id === examId);
            
            if (examIndex !== -1) {
                if (!exams[examIndex].questions) {
                    exams[examIndex].questions = [];
                }
                exams[examIndex].questions.push(question);
                localStorage.setItem('exams', JSON.stringify(exams));
                
                // Reset form and reload questions
                form.reset();
                loadQuestions(examId);
            }
        }

        function loadQuestions(examId) {
            const exams = JSON.parse(localStorage.getItem('exams') || '[]');
            const exam = exams.find(e => e.id === examId);
            const questionsList = document.getElementById('questionsList');
            
            if (questionsList && exam) {
                if (!exam.questions || exam.questions.length === 0) {
                    questionsList.innerHTML = '<p>No questions added to this exam yet.</p>';
                } else {
                    questionsList.innerHTML = `
                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Question</th>
                                    <th>Options</th>
                                    <th>Correct Answer</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${exam.questions.map((question, index) => `
                                    <tr>
                                        <td>${index + 1}</td>
                                        <td>${question.text}</td>
                                        <td>${question.options.join(', ')}</td>
                                        <td>${question.options[question.correctAnswer]}</td>
                                        <td>
                                            <button onclick="deleteQuestion('${examId}', ${index})" class="btn btn-danger">Delete</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                }
            }
        }

        function deleteQuestion(examId, questionIndex) {
            if (confirm('Are you sure you want to delete this question?')) {
                let exams = JSON.parse(localStorage.getItem('exams') || '[]');
                const examIndex = exams.findIndex(e => e.id === examId);
                
                if (examIndex !== -1) {
                    exams[examIndex].questions.splice(questionIndex, 1);
                    localStorage.setItem('exams', JSON.stringify(exams));
                    loadQuestions(examId);
                }
            }
        }

        // =============================================
        // Results Management
        // =============================================
        function loadResults() {
            const results = JSON.parse(localStorage.getItem('results') || '[]');
            const tbody = document.querySelector('#resultsTable tbody');
            tbody.innerHTML = '';

            results.forEach(result => {
                const tr = document.createElement('tr');
                const scorePercentage = Math.round((result.score / result.totalQuestions) * 100);
                tr.innerHTML = `
                    <td>${result.studentName}</td>
                    <td>${result.examTitle}</td>
                    <td>${result.score}/${result.totalQuestions}</td>
                    <td>${scorePercentage}%</td>
                    <td>${new Date(result.date).toLocaleString()}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // =============================================
        // Data Loading and Tab Management
        // =============================================
        function loadData(tabName) {
            switch(tabName) {
                case 'students':
                    loadStudents();
                    break;
                case 'exams':
                    loadExams();
                    loadExamSelect();
                    break;
                case 'questions':
                    loadExamSelect();
                    break;
                case 'results':
                    loadResults();
                    break;
            }
        }

        // =============================================
        // Authentication
        // =============================================
        function logout() {
            localStorage.removeItem('currentAdmin');
            window.location.href = 'login.html';
        }

        // Add this at the beginning of your script section
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            sidebar.classList.toggle('active');
        }

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(event) {
            const sidebar = document.querySelector('.sidebar');
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            
            if (window.innerWidth <= 768) {
                if (!sidebar.contains(event.target) && !mobileMenuBtn.contains(event.target)) {
                    sidebar.classList.remove('active');
                }
            }
        });
    </script>
</body>
</html> 